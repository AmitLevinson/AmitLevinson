---
title: R vs Python — Live Stream Analysis
author: Amit Levinson
date: '2022-06-02'
slug: r-and-python
categories: [R]
tags: [R, Streaming, Python]
subtitle: 'Questions and answers from the live stream of an R vs Python data analysis'
summary: 'Using both R and Python we answer various questions about the Dog of Zurich dataset. Try it yourself and get some hands-on data analysis practice'
featured: yes
image:
  caption: ''
  focal_point: ''
  preview_only: yes
projects: []
draft: false
codefolding_show: hide
editor_options: 
  chunk_output_type: console
---

<script src="{{< blogdown/postref >}}index_files/font-awesome/js/script.js"></script>


<p>A few months ago <a href="https://www.linkedin.com/in/talnmizrachi/">Tal Mizrachi</a> (The famous <a href="https://www.facebook.com/go.analysis.paralysis">Analysis Paralysis</a>) &amp; I <a href="https://www.youtube.com/watch?v=oO8MZWk07q0">live streamed</a> an R vs Python data analysis session (in Hebrew). We took the <a href="https://www.kaggle.com/kmader/dogs-of-zurich">dogs of Zurich dataset</a>, formatted it a bit, added a random DOB column and wrote down a few questions we answered during the live stream, each with his own tool.</p>
<p>Besides it being a great experience collaborating with Tal, I think the questions overall touched on various aspects of our day-to-day data analysis flow. I initially <a href="https://amitlevinson.github.io/streaming/r_and_python/index.html">hosted the questions and answers on a GitHub page</a> but realized they got lost in the abyss called ‘internet’. Instead, I am journalizing it on my website for future me as I pick up Python and others who want to practice their analysis skills. If you liked it, came up with a different solution or just want to share how much you love <s>Python</s> <strong>R</strong>, do reach out to either one of us and let us know. We’d love to hear more about your experience!</p>
<div id="how-should-you-read-this-post" class="section level3">
<h3>How should you read this post?</h3>
<p>My recommendation is to <strong>first try solving the questions yourself.</strong> You can find the data-files in the link below:</p>
<a href="https://github.com/AmitLevinson/streaming/raw/main/r_and_python/split_data.zip">
<button class="btn btn-default" output_name="Files from downloadthis"><i class="fa fa-save"></i> Download files</button>
</a>
<p>Great, now that you have the data, answer the following questions with any tool you’d like. Once you have the solutions you can check them with our solutions below (just click on the question). If you’re struggling you can use the output from our answers as a hint before viewing the answer in the code chunks.</p>
</div>
<div id="the-questions" class="section level3">
<h3>The Questions</h3>
<p><a href="#q1">1. Load the files into memory and combine them into a single Dataframe</a></p>
<p><a href="#q2">2. Describe the data using a summary function of sort</a></p>
<p><a href="#q3">3. What are the top 10 most common colors? Each color should be counted separately, i.e. black/brown should be counted as 1 black, 1 brown.</a></p>
<p><a href="#q4">4. What are the top 10 most common primary breeds by dog gender? Visualize it using a corresponding bar plot</a></p>
<p><a href="#q6">5. Who (owner) has dogs with the largest age gap between them? What’s the gap value?</a></p>
<p><a href="#q7">6. Save the Dataframe into an excel file where each sheet is a different age-group of owners</a></p>
</div>
<div id="the-answers" class="section level3">
<h3>The Answers</h3>
<p>The following section has the answers to the questions in both Python (by Tal) and R (by me). For each question you’ll find the answers in code, an output of the code and a follow up explanation for the R code or procedure we took. The code is collapsed and hidden, so just click to see it.</p>
<p><br></p>
<div id="q1" class="section level6">
<h6>1. Load the files into memory and combine them into a single Dataframe</h6>
<p><strong>Python <i class="fab fa-python"></i></strong></p>
<pre class="python"><code>import pandas as pd
import numpy as np
import os
import matplotlib.pyplot as plt
import seaborn as sns</code></pre>
<pre class="python"><code>all_files = []
for file in os.listdir(&quot;split_data/&quot;):
    if not file.endswith(&quot;csv&quot;):
        continue
    all_files.append(pd.read_csv(&quot;split_data/&quot;+file))

df = pd.concat(all_files, ignore_index=True)

df</code></pre>
<pre><code>##       owner_id    age gender  ...  dog_gender    dog_color     dog_dob
## 0       124913  41-50      w  ...           m    saufarben  1996-11-10
## 1        84494  61-70      w  ...           w  schwarz/rot  1997-08-10
## 2        85293  81-90      w  ...           w  beige/weiss  1997-09-10
## 3        80204  51-60      w  ...           m   dreifarbig  1998-08-10
## 4        80399  61-70      w  ...           m     tricolor  1998-08-10
## ...        ...    ...    ...  ...         ...          ...         ...
## 7150    135725  31-40      w  ...           w   gelb/weiss  2016-03-10
## 7151    135726  11-20      w  ...           w      schwarz  2016-09-10
## 7152    135728  31-40      w  ...           w   vierfarbig  2016-02-10
## 7153    135731  21-30      m  ...           m      schwarz  2016-12-10
## 7154     67272  31-40      w  ...           w     tricolor  2017-05-10
## 
## [7155 rows x 14 columns]</code></pre>
<p><strong>R <i class="fab fa-r-project"></i></strong></p>
<pre class="r"><code>library(tidyverse)
library(tidytext)
library(skimr)</code></pre>
<pre class="r"><code>files &lt;- paste0(&quot;split_data/&quot;,list.files(path = &quot;split_data/&quot;))
dogs &lt;- map_dfr(files, read_csv, col_types = cols())

dogs</code></pre>
<pre><code>## # A tibble: 7,155 × 14
##    owner_id age   gender city_district quarter primary_breed           is_hybrid
##       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;    
##  1   124913 41-50 w                 11     115 Spitz                   Mischling
##  2    84494 61-70 w                 10     102 Dachshund               &lt;NA&gt;     
##  3    85293 81-90 w                 11     115 Malteser                Mischling
##  4    80204 51-60 w                 11     111 Appenzeller             &lt;NA&gt;     
##  5    80399 61-70 w                 12     123 Appenzeller             Mischling
##  6    82293 71-80 w                  2      24 Mischling klein         &lt;NA&gt;     
##  7    82452 61-70 w                 10     102 Dachshund               &lt;NA&gt;     
##  8    82452 61-70 w                 10     102 Dachshund               &lt;NA&gt;     
##  9    83136 71-80 m                  3      31 Mischling klein         &lt;NA&gt;     
## 10    83476 61-70 w                 11     119 West Highland White Te… &lt;NA&gt;     
## # … with 7,145 more rows, and 7 more variables: secondary_breed &lt;chr&gt;,
## #   is_secondary_hybrid &lt;lgl&gt;, breed_type &lt;chr&gt;, dog_yob &lt;dbl&gt;,
## #   dog_gender &lt;chr&gt;, dog_color &lt;chr&gt;, dog_dob &lt;date&gt;</code></pre>
<p>In order to read the files we first create a vector called <code>files</code> with paths to all the relevant CSVs and load them using <code>purrr::map_dfr</code>. The latter runs <code>read_csv</code> on every element of <code>files</code>, our data file paths, and binds the rows together to one data frame. Basically we iterate across each file path, load it and then combine all of them together to data frame.</p>
<p><br></p>
</div>
<div id="q2" class="section level6">
<h6>2. Describe the data using a summary function of sort</h6>
<p><strong>Python <i class="fab fa-python"></i></strong></p>
<pre class="python"><code>df.describe(percentiles=[0.2,0.8])</code></pre>
<pre><code>##             owner_id  city_district  ...  is_secondary_hybrid      dog_yob
## count    7155.000000    7154.000000  ...                  0.0  7155.000000
## mean   105854.243326       7.413195  ...                  NaN  2009.803215
## std     21260.952718       3.261187  ...                  NaN     4.115384
## min       126.000000       1.000000  ...                  NaN  1996.000000
## 20%     87256.000000       4.000000  ...                  NaN  2006.000000
## 50%    105784.000000       8.000000  ...                  NaN  2010.000000
## 80%    126879.800000      11.000000  ...                  NaN  2014.000000
## max    135731.000000      12.000000  ...                  NaN  2017.000000
## 
## [8 rows x 5 columns]</code></pre>
<p><strong>R <i class="fab fa-r-project"></i></strong></p>
<pre class="r"><code>skimr::skim(dogs)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-7">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">dogs</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">7155</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">14</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">8</td>
</tr>
<tr class="odd">
<td align="left">Date</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">logical</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<colgroup>
<col width="21%" />
<col width="13%" />
<col width="18%" />
<col width="5%" />
<col width="5%" />
<col width="8%" />
<col width="12%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="right">1</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">primary_breed</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">34</td>
<td align="right">0</td>
<td align="right">304</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">is_hybrid</td>
<td align="right">6537</td>
<td align="right">0.09</td>
<td align="right">9</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">secondary_breed</td>
<td align="right">6612</td>
<td align="right">0.08</td>
<td align="right">4</td>
<td align="right">30</td>
<td align="right">0</td>
<td align="right">118</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">breed_type</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">dog_gender</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">dog_color</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">28</td>
<td align="right">0</td>
<td align="right">169</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table>
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="17%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dog_dob</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">1996-11-10</td>
<td align="left">2017-05-10</td>
<td align="left">2010-08-10</td>
<td align="right">226</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: logical</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">is_secondary_hybrid</td>
<td align="right">7155</td>
<td align="right">0</td>
<td align="right">NaN</td>
<td align="left">:</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<colgroup>
<col width="14%" />
<col width="10%" />
<col width="14%" />
<col width="10%" />
<col width="9%" />
<col width="5%" />
<col width="8%" />
<col width="7%" />
<col width="9%" />
<col width="7%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">owner_id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">105854.24</td>
<td align="right">21260.95</td>
<td align="right">126</td>
<td align="right">88587.5</td>
<td align="right">105784</td>
<td align="right">124634.5</td>
<td align="right">135731</td>
<td align="left">▁▁▁▇▇</td>
</tr>
<tr class="even">
<td align="left">city_district</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">7.41</td>
<td align="right">3.26</td>
<td align="right">1</td>
<td align="right">5.0</td>
<td align="right">8</td>
<td align="right">10.0</td>
<td align="right">12</td>
<td align="left">▅▂▅▅▇</td>
</tr>
<tr class="odd">
<td align="left">quarter</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">76.70</td>
<td align="right">33.03</td>
<td align="right">4</td>
<td align="right">51.0</td>
<td align="right">81</td>
<td align="right">102.0</td>
<td align="right">123</td>
<td align="left">▂▃▆▅▇</td>
</tr>
<tr class="even">
<td align="left">dog_yob</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2009.80</td>
<td align="right">4.12</td>
<td align="right">1996</td>
<td align="right">2007.0</td>
<td align="right">2010</td>
<td align="right">2013.0</td>
<td align="right">2017</td>
<td align="left">▁▃▆▇▇</td>
</tr>
</tbody>
</table>
<p><code>skmir::skim</code> provides a summary of the data by column type. You can also use <code>summary</code> and <code>glimpse</code>.</p>
<p><br></p>
</div>
<div id="q3" class="section level5">
<h5>3. What are the top 10 most common colors? Each color should be counted separately, i.e. black/brown should be counted as 1 black, 1 brown</h5>
<p><strong>Python <i class="fab fa-python"></i></strong></p>
<pre class="python"><code>melted = df[&#39;dog_color&#39;].str.split(&quot;/&quot;, expand=True).melt().copy()

melted[&#39;value&#39;].value_counts()</code></pre>
<pre><code>## schwarz                2349
## weiss                  2207
## braun                  1836
## tricolor                696
## beige                   622
##                        ... 
## bicolor                   1
## schwarz melliert          1
## hirschrot mit Maske       1
## marronschimmel            1
## rotblond                  1
## Name: value, Length: 89, dtype: int64</code></pre>
<p><strong>R <i class="fab fa-r-project"></i></strong></p>
<pre class="r"><code>dogs %&gt;% 
  transmute(
    new_color = strsplit(dog_color, split = &quot;/&quot;)
    ) %&gt;% 
  unnest() %&gt;% 
  count(new_color, sort = T)</code></pre>
<pre><code>## # A tibble: 89 × 2
##    new_color     n
##    &lt;chr&gt;     &lt;int&gt;
##  1 schwarz    2349
##  2 weiss      2207
##  3 braun      1836
##  4 tricolor    696
##  5 beige       622
##  6 rot         368
##  7 grau        282
##  8 tan         228
##  9 hellbraun   170
## 10 black       160
## # … with 79 more rows</code></pre>
<p>Our color column is comprised of several values in per observation. We <code>split</code> the strings to single colors which turns each observation to a list of values (our colors), and we then <code>unnest</code> the list and count the colors.</p>
<p><br></p>
</div>
<div id="q4" class="section level5">
<h5>4. What are the top 10 most common primary breeds by dog gender? Visualize it using a bar plot</h5>
<p><strong>Python <i class="fab fa-python"></i></strong></p>
<pre class="python"><code>main_table = df[[&#39;dog_gender&#39;,&#39;primary_breed&#39;]].pivot_table(index=&#39;primary_breed&#39;, columns=&#39;dog_gender&#39;, aggfunc=len).copy()


sorted_by_w = main_table.sort_values(&#39;w&#39;, ascending=False).head(10).copy()
sorted_by_m = main_table.sort_values(&#39;m&#39;, ascending=False).head(10).copy()


fig, axes = plt.subplots(1,2)

fig.suptitle(&quot;This is a title&quot;, fontsize=18)

sorted_by_w.plot(kind=&#39;bar&#39;, rot=40, color=[&quot;pink&quot;, &quot;teal&quot;], ax=axes[0], figsize=(20,12))
sorted_by_m.plot(kind=&#39;bar&#39;, rot=40, color=[&quot;pink&quot;, &quot;teal&quot;], ax=axes[1], figsize=(20,12))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="1920" /></p>
<p><strong>R <i class="fab fa-r-project"></i></strong></p>
<pre class="r"><code>dogs %&gt;% 
  count(dog_gender, primary_breed, sort = T) %&gt;% 
  group_by(dog_gender) %&gt;% 
  slice(1:10) %&gt;% 
  ggplot(aes(y = reorder_within(primary_breed, by =  n, within = dog_gender), x = n)) +
  geom_col() +
  facet_wrap(vars(dog_gender), scales = &quot;free_y&quot;) +
  scale_y_reordered() +
  labs(y = NULL, title = &quot;This is a title&quot;)+
  theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-11-3.png" width="672" /></p>
<p>I start by counting the primary breed within each gender. I then visualize the data with ggplot2, leveraging the <code>reorder_within</code>, a function from <code>tidytext</code> to reorder the categories within each facet (gender). Alternatively we can remove the <code>reorder_within</code> and compare the primary breeds across gender instead of within.</p>
<p><br></p>
</div>
<div id="q6" class="section level5">
<h5>5. Who (owner) has dogs with the largest age gap between them? What’s the gap value?</h5>
<p><strong>Python <i class="fab fa-python"></i></strong></p>
<pre class="python"><code>df[&#39;dog_dob&#39;] = pd.to_datetime(df[&#39;dog_dob&#39;])
gb = df[[&#39;owner_id&#39;, &#39;dog_dob&#39;]].groupby(&#39;owner_id&#39;).agg([min, max])

gb.columns = [&quot;_&quot;.join(list(x)) for x in gb.columns]

gb[&#39;diff&#39;] = (gb[&#39;dog_dob_max&#39;]-gb[&#39;dog_dob_min&#39;]).dt.days

gb.sort_values(&#39;diff&#39;).tail(1)</code></pre>
<pre><code>##          dog_dob_min dog_dob_max  diff
## owner_id                              
## 87158     2000-04-10  2015-10-10  5661</code></pre>
<p><strong>R <i class="fab fa-r-project"></i></strong></p>
<pre class="r"><code>dogs %&gt;% 
  group_by(owner_id) %&gt;% 
  filter(
    n() &gt; 1,
    dog_dob == min(dog_dob) | dog_dob == max(dog_dob)
  ) %&gt;% 
  select(owner_id, dog_dob) %&gt;% 
  arrange(owner_id, dog_dob) %&gt;% 
  summarise(
    timediff = difftime(dog_dob, time2 = lag(dog_dob), units = &quot;days&quot;)
  ) %&gt;% 
  fill(timediff, .direction = &quot;up&quot;) %&gt;% 
  arrange(-timediff)</code></pre>
<pre><code>## # A tibble: 1,153 × 2
## # Groups:   owner_id [576]
##    owner_id timediff 
##       &lt;dbl&gt; &lt;drtn&gt;   
##  1    87158 5661 days
##  2    87158 5661 days
##  3    88250 5265 days
##  4    88250 5265 days
##  5   100112 5234 days
##  6   100112 5234 days
##  7   109472 4932 days
##  8   109472 4932 days
##  9   128461 4932 days
## 10   128461 4932 days
## # … with 1,143 more rows</code></pre>
<p>I start off by filtering to owners having at least two dogs and take the oldest and youngest dog for each owner. I then arrange the dob within each owner’s group, calculate the difference between the ages and arrange by the difference in a descending order, giving us the owner with the largest gap.</p>
<p>During the session <a href="https://adisarid.github.io/">Adi Sarid</a> suggested another solution, overall more concise and also to my liking. Instead of counting, filtering, etc., he suggests to straight up calculate the age differce between oldest and youngest dog and arrange that in a descending order:</p>
<pre class="r"><code>dogs %&gt;% 
  group_by(owner_id) %&gt;% 
  summarise(age_gap = max(dog_dob) - min(dog_dob)) %&gt;% 
  arrange(desc(age_gap))</code></pre>
<p><br></p>
</div>
<div id="q7" class="section level5">
<h5>6. Save the Dataframe into an excel file where each sheet is a different age-group of owners</h5>
<p><strong>Python <i class="fab fa-python"></i></strong></p>
<pre class="python"><code>writer = pd.ExcelWriter(&quot;dogs_by_owner_age_python.xlsx&quot;)

for age in df[&#39;age&#39;].fillna(&quot;None&quot;).unique():
    temp_df = df[df[&#39;age&#39;]==age].copy()
    temp_df.to_excel(writer, sheet_name=age)

writer.save()</code></pre>
<p><strong>R <i class="fab fa-r-project"></i></strong></p>
<pre class="r"><code>dogs %&gt;% 
  split(.$age) %&gt;% 
  writexl::write_xlsx(path = &quot;dogs_by_owners_age.xlsx&quot;)</code></pre>
<p>I really like here the use of <code>split</code> that splits a data frame into various lists by the variable passed to it. we can then use that – our object of data frames split by age – and pass it to <code>write_xlsx</code> that saves each element of the list as a sheet in our newly written <code>.xlsx</code> file.</p>
<hr />
<p>That’s it, hope you enjoyed solving the questions. Make sure to checkout the <a href="https://www.youtube.com/watch?v=oO8MZWk07q0">recording!</a></p>
</div>
</div>
