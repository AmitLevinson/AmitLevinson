---
title: Nicely Printing Categorical Variables with KableExtra
author: Amit Levinson
date: '2020-05-01'
slug: printing-table
categories: []
tags: []
subtitle: ''
summary: "A tribute for for the KableExtra's ability to aestheticaly print descriptives for categorical variables"
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
draft: true
editor_options:
  chunk_output_type: console
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<style>
p.caption {
  font-size: 0.8em;
}
</style>
<p>This post is somewhat of a ~love post~ tribute to both the iteration abilities in R combined with the <a href="https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html"><code>KableExtra</code></a> package. I set myself several goals for my thesis, one of them is doing my survey analysis in something other than SPSS. I wanted to finish my Masters’ with some broader knowledge of statistical programs and dive a little more into coding. I started learning R nearly a year ago so that when the time comes - When my pilot and survey results come in - I can analyze it all in R.</p>
<p>The time came and I started to analyze the data in R. However, the problem was, That I wasn’t going to do an OK job. After discovering much of R’s abilities, I wasn’t going to let myself copy+paste. So I wrote a few functions, manipulated some of the work and then it was time to get out the big guns; well big guns at least for me.</p>
<div id="the-problem" class="section level3">
<h3>The Problem</h3>
<p>In my pilot survey I had several questions (~20) that were categorical, ordinal and were simple constructs that didn’t require a more thorough analysis such as reliability of the scale. I wanted to nicely print all of these variables in one table, address any anomalies if needed and have them in the appendix for my supervisors to review.</p>
<p><strong>The issue was, how can I nicely print all categorical variables along with the original question, the possible answers and the distribution of responses?</strong></p>
<p>First, let’s look at our data:</p>
<pre class="r"><code>library(tidyverse) # dplyr, tidyr, readr &amp; purrr
library(here) # Project management
library(readxl) # For reading excel files
library(knitr) # Printing tables
library(kableExtra) # Printing tables, but nice ones
library(janitor) # To clean names
df_survey &lt;- read_xlsx(here(&quot;content&quot;, &quot;post&quot;, &quot;printing-categorical-variables-questions-with-kableextra&quot;, &quot;data&quot;,&quot;survey.xlsx&quot;))

head(df_survey)</code></pre>
<pre><code>## # A tibble: 6 x 12
##   Q2     Q4     Q6     Q7    Q11_1   Q13_1   Q15   Q26   Q27   Q30   Q32   Q37  
##   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 Female Salar~ Simil~ Cent~ Once a~ At lea~ Never No    &lt;NA&gt;  &lt;NA&gt;  No    Yes  
## 2 Female Salar~ Below~ South Severa~ Every ~ Never No    &lt;NA&gt;  &lt;NA&gt;  No    Yes  
## 3 Female Stude~ Below~ South Betwee~ I&#39;ve n~ Never No    &lt;NA&gt;  &lt;NA&gt;  No    Yes  
## 4 Female Unemp~ Simil~ Cent~ Once a~ At lea~ Last~ No    &lt;NA&gt;  &lt;NA&gt;  No    Yes  
## 5 Male   Salar~ Simil~ Cent~ Once a~ At lea~ Last~ Yes   2-3 ~ Yes   No    No   
## 6 Female Salar~ Simil~ Cent~ Severa~ Last t~ Never No    &lt;NA&gt;  &lt;NA&gt;  No    Yes</code></pre>
<p>So we have a lot of information regarding our sample  data we collected. In order to nicely print all of our <em>character</em> columns, let’s start by removing anything other than a character column:</p>
<pre class="r"><code>df_char &lt;- df_survey %&gt;% 
  janitor::clean_names () %&gt;% 
  select_if(is.character) </code></pre>
<p>we’ll need to change the data to a long form. A first thought the comes to mind is to use the <code>pivot_longer</code> argument so that we have everything in one nice long table:</p>
<pre class="r"><code>df_long &lt;- df_char %&gt;% 
  pivot_longer(q2:q37, names_to = &quot;question&quot;) %&gt;% 
  count(question, value) %&gt;%
  group_by(question) %&gt;% 
  mutate(pct = n/sum(n)*100)


knitr::kable(df_long) %&gt;% 
  kableExtra::kable_styling() %&gt;% 
  kableExtra::scroll_box(height = &quot;400px&quot;)</code></pre>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
question
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
value
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
n
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
pct
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
Between once a week to once in a month
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14.705882
</td>
</tr>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
Less than once a month
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
11.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
Once a day
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17.647059
</td>
</tr>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
Once a week
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
11.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
Several times a day
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17.647059
</td>
</tr>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
Several times a week
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
23.529412
</td>
</tr>
<tr>
<td style="text-align:left;">
q11_1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q13_1
</td>
<td style="text-align:left;">
About every week
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q13_1
</td>
<td style="text-align:left;">
At least once a month
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
38.235294
</td>
</tr>
<tr>
<td style="text-align:left;">
q13_1
</td>
<td style="text-align:left;">
Every three months
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14.705882
</td>
</tr>
<tr>
<td style="text-align:left;">
q13_1
</td>
<td style="text-align:left;">
Every three to six months
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
11.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q13_1
</td>
<td style="text-align:left;">
I’ve never bought
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14.705882
</td>
</tr>
<tr>
<td style="text-align:left;">
q13_1
</td>
<td style="text-align:left;">
Last time I bought was over half a year ago
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17.647059
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Last half a year
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8.823529
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Last month
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5.882353
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Last three months
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8.823529
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Last week
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Last year
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Never
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
52.941176
</td>
</tr>
<tr>
<td style="text-align:left;">
q15
</td>
<td style="text-align:left;">
Over a year ago
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17.647059
</td>
</tr>
<tr>
<td style="text-align:left;">
q2
</td>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
47.058824
</td>
</tr>
<tr>
<td style="text-align:left;">
q2
</td>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
52.941176
</td>
</tr>
<tr>
<td style="text-align:left;">
q26
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
58.823529
</td>
</tr>
<tr>
<td style="text-align:left;">
q26
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
38.235294
</td>
</tr>
<tr>
<td style="text-align:left;">
q26
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q27
</td>
<td style="text-align:left;">
2-3 times
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
11.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q27
</td>
<td style="text-align:left;">
5-7 times
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
11.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q27
</td>
<td style="text-align:left;">
Over 7 times
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14.705882
</td>
</tr>
<tr>
<td style="text-align:left;">
q27
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
61.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q30
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q30
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
35.294118
</td>
</tr>
<tr>
<td style="text-align:left;">
q30
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
61.764706
</td>
</tr>
<tr>
<td style="text-align:left;">
q32
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
79.411765
</td>
</tr>
<tr>
<td style="text-align:left;">
q32
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14.705882
</td>
</tr>
<tr>
<td style="text-align:left;">
q32
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5.882353
</td>
</tr>
<tr>
<td style="text-align:left;">
q37
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
17.647059
</td>
</tr>
<tr>
<td style="text-align:left;">
q37
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
73.529412
</td>
</tr>
<tr>
<td style="text-align:left;">
q37
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8.823529
</td>
</tr>
<tr>
<td style="text-align:left;">
q4
</td>
<td style="text-align:left;">
Salaried employee
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
52.941176
</td>
</tr>
<tr>
<td style="text-align:left;">
q4
</td>
<td style="text-align:left;">
Self employed
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8.823529
</td>
</tr>
<tr>
<td style="text-align:left;">
q4
</td>
<td style="text-align:left;">
Student
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
23.529412
</td>
</tr>
<tr>
<td style="text-align:left;">
q4
</td>
<td style="text-align:left;">
Student,Salaried employee
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
8.823529
</td>
</tr>
<tr>
<td style="text-align:left;">
q4
</td>
<td style="text-align:left;">
Student,Unemployed
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q4
</td>
<td style="text-align:left;">
Unemployed
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.941177
</td>
</tr>
<tr>
<td style="text-align:left;">
q6
</td>
<td style="text-align:left;">
Above average
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14.705882
</td>
</tr>
<tr>
<td style="text-align:left;">
q6
</td>
<td style="text-align:left;">
Below average
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
47.058824
</td>
</tr>
<tr>
<td style="text-align:left;">
q6
</td>
<td style="text-align:left;">
Similar to average
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
38.235294
</td>
</tr>
<tr>
<td style="text-align:left;">
q7
</td>
<td style="text-align:left;">
Center
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
47.058824
</td>
</tr>
<tr>
<td style="text-align:left;">
q7
</td>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
52.941176
</td>
</tr>
</tbody>
</table>
</div>
<p>Great, this prints nicely, but we’re left with several issues to address:</p>
<p><strong>1. We’re missing the actual questions</strong> - Notice how we only have “q10_1” but not description of what the actual question or variable is.</p>
<p><strong>2. Questions were reorganized alphabetically</strong> - Once we ran the <code>pivot_longer</code> <code>R</code> sorted our new dataframe alphabetically according to the question variable, but we might want it ordered chronologically according to the survey. Of course this is contingent on your data, I wanted to show it aligned to the order of the survey questions.</p>
<p><strong>3. Some of the responses aren’t ordered</strong> - Notice how some of the responses are randomly ordered, when ideally we’d want them to be ordered by hierarchy. For example question XXXXX</p>
<p><strong>4. Remove duplicated information</strong> - Our column question, and if we add another with the text, will have duplicate information. While the value changes within questions, we don’t need to show it’s from that question only once. In addition, once we’ll add the question title it’ll be even more cluttered, so we’ll have to deal with that.</p>
<p>Let’s address these issues and nicely finish up our table.</p>
<div id="adding-information-to-our-questions" class="section level4">
<h4>Adding information to our questions</h4>
<p>When you download the survey data from Qualtrics you also receive it with the original questions. When I personally analyzed the data I removed it, but here it’s perfect for providing additional information. If you don’t have questions but variables, you can either skip this section or add information about the variables themselves.</p>
<p>To add the questions I found it pretty straight forward to just to combine the current data_long dataset with a dataset containing our questions. We’ll use a copy of the original survey data that only contains the questions, let’s have a look:</p>
<pre class="r"><code>df_questions &lt;- read_xlsx(here(&quot;content&quot;, &quot;post&quot;, &quot;printing-categorical-variables-questions-with-kableextra&quot;, &quot;data&quot;, &quot;questions.xlsx&quot;))
df_questions[,1:3]</code></pre>
<pre><code>## # A tibble: 1 x 3
##   Q2     Q4                   Q6                                                
##   &lt;chr&gt;  &lt;chr&gt;                &lt;chr&gt;                                             
## 1 Gender What&#39;s your occupat~ The average income for an individual is X, you&#39;re~</code></pre>
<p>Great, now let’s turn it to a long format so that each row is a question id with the details of it as a value. Then we can join it with our current dataset of answers:</p>
<pre class="r"><code>df_q_clean &lt;- df_questions %&gt;% 
  clean_names() %&gt;% 
  pivot_longer(cols = q2:q37, names_to = &quot;question&quot;, values_to = &quot;text&quot;) 

df_long &lt;-  inner_join(df_long, df_q_clean, by = c(&quot;question&quot; = &quot;question&quot;))

head(df_long)</code></pre>
<pre><code>## # A tibble: 6 x 5
## # Groups:   question [1]
##   question value                            n   pct text                        
##   &lt;chr&gt;    &lt;chr&gt;                        &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;                       
## 1 q11_1    Between once a week to once~     5  14.7 Every how often do you cons~
## 2 q11_1    Less than once a month           4  11.8 Every how often do you cons~
## 3 q11_1    Once a day                       6  17.6 Every how often do you cons~
## 4 q11_1    Once a week                      4  11.8 Every how often do you cons~
## 5 q11_1    Several times a day              6  17.6 Every how often do you cons~
## 6 q11_1    Several times a week             8  23.5 Every how often do you cons~</code></pre>
<p>Using the <code>inner_join</code> we kept only questions we want to display. Now let’s turn to our second issue and address the order of our questions. Basically, we want it to be ordered by the value of the number itself and not how it’s sorted alphabaetically (q11_1 before q_5). What we’ll do, and there might be a quicker way, is use regex (regular expression) to use the number values to sort by. Here it goes:</p>
<pre class="r"><code>df_long_sorted &lt;- df_long %&gt;% 
  mutate(q_num = str_remove_all(question, &quot;[a-z]&quot;),
    q_num = str_replace_all(q_num, &quot;_&quot;, &quot;.&quot;),
    q_num = str_remove(q_num, &quot;\\.$&quot;),
    q_num = as.numeric(q_num)) %&gt;% 
  group_by(question) %&gt;% 
  arrange(q_num) %&gt;% 
  select(-q_num)

head(df_long_sorted)</code></pre>
<pre><code>## # A tibble: 6 x 5
## # Groups:   question [2]
##   question value                         n   pct text                   
##   &lt;chr&gt;    &lt;chr&gt;                     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;                  
## 1 q2       Female                       16 47.1  Gender                 
## 2 q2       Male                         18 52.9  Gender                 
## 3 q4       Salaried employee            18 52.9  What&#39;s your occupation?
## 4 q4       Self employed                 3  8.82 What&#39;s your occupation?
## 5 q4       Student                       8 23.5  What&#39;s your occupation?
## 6 q4       Student,Salaried employee     3  8.82 What&#39;s your occupation?</code></pre>
<p>Perfect!</p>
<p>We used some simple regular expressions to create a variable containing only our question number and sorted it by it. Now that we got that out of the way, let’s head on to our next issue. Our next problem is that we want some of our questions to be organized not by the count or some randomness, but by hierarchy of the answer options, for example ‘a few times a day’, ‘Once a day’, ‘several times a week’ and so on.<br />
Personally, I didn’t have a magicly automated answer but manualy provided levels to each answer. You can do this by setting them as a factor, or the way I did it: Create another table with the possible answer options and provide each answer with a value. You can then sort the answers by the order of numbers you provided, let’s have a look:</p>
<p>Alright! Much better!</p>
</div>
</div>
<div id="map-map_df" class="section level3">
<h3>map &amp; map_df</h3>
<p>The issue we’re facing also provides us with a great opportunity to explore <a href="https://purrr.tidyverse.org/">{purrr’s}</a> <code>map</code> and <code>map_df</code>. If we think back on what we just did, we basically aggregated all our columns into one so we can compute the frequency of each category. But what if instead of manipulating them when they’re in one column, we manipulate each of the original columns?</p>
</div>
